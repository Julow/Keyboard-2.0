package juloo.common;

import android.content.Context;
import android.content.res.TypedArray;
import android.preference.DialogPreference;
import android.util.AttributeSet;
import android.view.View;
import android.view.ViewGroup;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.EditText;
import android.text.Editable;
import android.text.TextWatcher;
/*
 ** ColorPreference 
 ** -
 ** Open a dialog showing a seekbar
 ** -
 ** xml attrs:
 **   android:defaultValue  Default value (String)
 ** -
 ** Summary field allow to show the current value using %s flag
 */
public class ColorPreference extends DialogPreference
    implements TextWatcher
{
  private LinearLayout _layout;
  private TextView _textView;
  private EditText _editText;


  private String _initialSummary;

  public ColorPreference(Context context, AttributeSet attrs)
  {
    super(context, attrs);
    _initialSummary = getSummary().toString();
    _textView = new TextView(context);
    _textView.setPadding(48, 40, 48, 40);
    _editText = new EditText(context);
    _editText.addTextChangedListener(this);
    _layout = new LinearLayout(getContext());
    _layout.setOrientation(LinearLayout.VERTICAL);
    _layout.addView(_textView);
    _layout.addView(_editText);
  }


  public void beforeTextChanged(CharSequence s, int start, int count, int after) {}
  public void onTextChanged(CharSequence s, int start, int before, int count) {}

  public void afterTextChanged(Editable s) {
    updateText();
  }

  @Override
  protected void onSetInitialValue(boolean restorePersistedValue, Object defaultValue)
  {
    String value;

    if (restorePersistedValue)
    {
      value = getPersistedString("");
    }
    else
    {
      value = (String)defaultValue;
      persistString(value);
    }
    _editText.setText(value);
    updateText();
  }

  @Override
  protected Object onGetDefaultValue(TypedArray a, int index)
  {
    return (a.getString(index));
  }

  @Override
  protected void onDialogClosed(boolean positiveResult)
  {
    if (positiveResult)
      persistString(_editText.getText().toString());
  }

  protected View onCreateDialogView()
  {
    ViewGroup parent = (ViewGroup)_layout.getParent();

    if (parent != null)
      parent.removeView(_layout);
    return (_layout);
  }

  private void updateText()
  {
    String f = String.format(_initialSummary, _editText.getText().toString());

    _textView.setText(f);
    setSummary(f);
  }
}
